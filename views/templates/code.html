{include file="header.html"}

{include file="tipbox.html"}


<script type="text/javascript">
SyntaxHighlighter.all();
var converter = new Showdown.converter();
</script>

<script id="commentTemplate" type="text/html">
{literal}
<div class="inlineComment e${range_text} comment${commentID}" data-range='${range_text}' data-id='${db_id}' data-file='${fileID}'>
	<span class="hiddenPlainText htext${range_text}" data-range='${range_text}'>${text}</span>
		<div class="${range_text} commentbox">
			<span class="inlineCommentText ctext${range_text}">
					{{html formattedText}}
			</span>
			<div class="commentauthor">${commenter}</div>
			<div style="clear:both"></div>
		</div>
</div>
{/literal}
</script>

<div id="codeheader">
{if $role >= $POSITION_SECTION_LEADER}
<span class="link"><a href="{$course->get_link()}/assignment/{$the_sl->sunetid}/{$assignment}">{$assignment}</a></span>
{else}
{$assignment}
{/if}
:
<span class="link"><a href="{$the_student->get_link()}">{$the_student->display_name}</a></span>

<span class="small-header">Section Leader: {$the_sl->sunetid}</span>


<!-- <span class="small-header right hover-underline"><a title="Download code and comments as text file" href="{$root_url}{$class}/download/{$assignment}/{$numbered_submission}/{$assignment}_comments.txt">Download</a></span>
</div> -->

{if !isset($print_view)}
<div id="filelist">
    {foreach from=$code_files item=info key=file name=codeloop}
    <span class="filelink" data-id='{$smarty.foreach.codeloop.index}'>
	<a href="#" data-name="{$file}" data-id='{$smarty.foreach.codeloop.index}'>
		{$file}
	</a>
	</span>
    {/foreach}

	<div style="clear:both"></div>


<!-- 	{if isset($message)}
	<div id="message">
		{$message}
	</div>
	{/if} -->

</div>

<div style="clear:both"></div>


{/if}

<script type="text/javascript">
{if $role >= $POSITION_SECTION_LEADER and !isset($print_view)}
CodeManager.interactive = true;
var interactive = true;
{else}
CodeManager.interactive = false;
var interactive = false;
{/if}
    function hideAllComments() {
        $('.inlineComment').hide();
    }

    function displayAllComments() {
        $('.inlineComment').show();
    }

</script>

{foreach from=$code_files item=info key=file name=codeloop}
<div class="comments_holder" data-id='{$smarty.foreach.codeloop.index}'>
{if $showComments}
{foreach from=$info['assn']->getAssignmentComments() item=comment}
<div id="etop{$comment->getStartLine()}-{$comment->getEndLine()}" class="inlineComment" data-range="{$comment->getStartLine()}-{$comment->getEndLine()}"
data-id="{$comment->getID()}">
<span class="comment hiddenPlainText">{$comment->getCommentText()|stripslashes}</span>
<span class="commenter hiddenPlainText">{$comment->getCommenter()}</span>
</div>
{/foreach}
{/if}

	
</div>
{/foreach}

{if !isset($print_view)}


<div id="rightside">

<!-- <div id="printlink">
	<div class="link smaller"><a href="{$code_file}/print" target="_blank">Print</a></div>
</div> -->

{if $role >= $POSITION_SECTION_LEADER}
<div id="release">
	<form class="link smaller">
	<input type="checkbox" name="release" value="" {if $release}checked{/if} />Release<br />
    <p><a href="javascript: hideAllComments()">Hide comments</a></p>
    <p><a href="javascript: displayAllComments()">Show comments</a></p>
    <p><a href="javascript: showOnlyComments()">Only comments</a></p>
	</form>
</div>

<div id="saved" class="hidden">
	Saved.
</div>

{/if}
</div>
{/if}

{foreach from=$code_files item=info key=file name=codeloop}
<div class="code_container" data-name="{$file}" data-id='{$smarty.foreach.codeloop.index}'>
	<pre class="brush: cpp; gutter: false;">
{$info.contents}
	</pre>
</div>
{/foreach}
